(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){e.exports=n(128)},108:function(e,t,n){},113:function(e,t,n){},117:function(e,t,n){},118:function(e,t,n){},119:function(e,t,n){},121:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},124:function(e,t,n){},125:function(e,t,n){},127:function(e,t,n){},128:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(12),o=n.n(i),c=n(40),s=n(19),u=n(15),l=n(21),p=n(20),d=n(22),v=n(30),m=n(82),g=n.n(m),h=n(28),f=n(131),E=n(171),k=n(172),b=n(173),S=n(91),w=n(183),B=n(130),C=n(170),y=n(167),x=n(169),O=Object(y.a)({root:{font:"inherit",textDecoration:"none"},default:{},primary:{},secondary:{background:x.a[300],"&:hover":{backgroundColor:x.a[500]},"&:active":{backgroundColor:x.a[500]},"&.active":{backgroundColor:x.a[500]}}});function A(e){var t,n=O();switch(e.color){case"primary":t=n.primary;break;case"secondary":t=n.secondary;break;default:t=n.default}return r.a.createElement(C.a,Object.assign({},e,{classes:{root:n.root,contained:t,text:t,outlined:t}}),e.children)}n(108);var I=Object(f.a)(function(e){return{root:{flexGrow:1},menuButton:{},title:{flexGrow:1}}});function j(e){var t=r.a.useState(null),n=Object(v.a)(t,2),a=n[0],i=n[1];function o(){i(null)}var c=e.appState,s=e.switchRegisterLogin,u=e.logout,l=c.navigation,p=l.isAtLogin,d=l.isAtRegister,m=c.auth.token.length>0,f=I();return r.a.createElement(E.a,{position:"static",className:f.root,id:"MainNavBar"},r.a.createElement(k.a,null,r.a.createElement(b.a,{id:"NavbarMenuOpenButton",edge:"start",className:f.menuButton,color:"inherit","aria-label":"menu","aria-controls":"NavbarMenu","aria-haspopup":"true",onClick:function(e){i(e.currentTarget)}},r.a.createElement(g.a,null)),r.a.createElement(S.a,{id:"NavbarMenu",anchorEl:a,keepMounted:!0,open:Boolean(a),onClose:o},m&&r.a.createElement(w.a,{onClick:o},r.a.createElement(h.b,{to:"/events"},r.a.createElement(A,{size:"small",type:"button",variant:"text",color:"default"},"Events"))),m&&r.a.createElement(w.a,{onClick:o},r.a.createElement(h.b,{to:"/bookings"},r.a.createElement(A,{size:"small",type:"button",variant:"text",color:"default"},"Bookings"))),m&&r.a.createElement(w.a,{onClick:o},r.a.createElement(h.b,{to:"/auth"},r.a.createElement(A,{onClick:u,size:"small",type:"button",variant:"text",color:"default"},"Logout"))),!m&&r.a.createElement(w.a,{onClick:o},r.a.createElement(h.b,{to:"/auth"},r.a.createElement(A,{onClick:s,size:"small",type:"button",variant:"text",color:"default"},p&&"Register",d&&"Login")))),r.a.createElement(B.a,{align:"left",variant:"h5",className:f.title},r.a.createElement(h.b,{to:"/"},"gEvent")),r.a.createElement("nav",{className:"main-navbar-wrapper"},r.a.createElement("ul",{className:"main-navbar-items"},!m&&r.a.createElement(h.b,{className:"auth",to:"/auth"},r.a.createElement(A,{onClick:s,size:"small",type:"button",variant:"contained",color:"primary"},p&&"Register",d&&"Login")),m&&r.a.createElement(h.b,{to:"/events"},r.a.createElement(A,{size:"small",type:"button",variant:"contained",color:"primary"},"Events")),m&&r.a.createElement(h.b,{to:"/bookings"},r.a.createElement(A,{size:"small",type:"button",variant:"contained",color:"primary"},"Bookings")),m&&r.a.createElement(h.b,{className:"auth",to:"/auth"},r.a.createElement(A,{onClick:u,size:"small",type:"button",variant:"contained",color:"primary"},"Logout"))))))}var M=n(39),N=n(11),L=(n(112),n(113),function(){return r.a.createElement(N.b,{containerId:"main-toastify",position:"top-right",autoClose:1200,hideProgressBar:!0,newestOnTop:!0,closeOnClick:!0,rtl:!1,draggable:!0,pauseOnHover:!0,transition:N.a})}),_=n(9),T=n.n(_),D=n(18),F=function(){function e(){Object(s.a)(this,e)}return Object(u.a)(e,null,[{key:"fetchServer",value:function(){var t=Object(D.a)(T.a.mark(function t(n,a){var r,i,o;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r={"Content-Type":"application/json",Authorization:""},t.prev=1,!a){t.next=10;break}if(!(a.length<1)){t.next=7;break}throw new Error("token received is invalid");case 7:r.Authorization="Bearer "+a;case 8:t.next=11;break;case 10:delete r.Authorization;case 11:return t.next=13,fetch(e.SERVER_URL,{method:"POST",body:JSON.stringify(n),headers:r});case 13:return i=t.sent,t.next=16,i.json();case 16:return o=t.sent,t.abrupt("return",o);case 20:throw t.prev=20,t.t0=t.catch(1),console.log(t.t0),t.t0;case 24:case"end":return t.stop()}},t,null,[[1,20]])}));return function(e,n){return t.apply(this,arguments)}}()}]),e}();F.SERVER_URL="http://graphql-booking-api.herokuapp.com/graphql/";var R=n(174);function U(e){return r.a.createElement(R.a,e)}var z=n(175),H=(n(117),function(e){var t=e.booking._id,n=e.booking.event;return r.a.createElement("li",{className:"booking-list-item"},r.a.createElement("div",{className:"booking-slim-info"},r.a.createElement(B.a,{className:"event-title",variant:"h6",color:"textPrimary"},n.title),r.a.createElement("div",{className:"slim-wrapper"},r.a.createElement(B.a,{className:"event-price",variant:"subtitle2",color:"textSecondary"},"$",n.price),r.a.createElement(B.a,{className:"event-date",variant:"subtitle2",color:"textSecondary"},new Date(n.date).toDateString()))),r.a.createElement("div",{className:"booking-actions"},r.a.createElement(A,{type:"button",color:"primary",variant:"outlined",size:"small",onClick:function(){if(t)return e.cancelBooking(t)},disabled:e.isCancelingBooking},"Cancel")))}),W=(n(118),function(e){var t=e.bookings;return t&&r.a.createElement("ul",{className:"booking-list"},t.map(function(t){return r.a.createElement(H,{key:t._id,booking:t,appState:e.appState,cancelBooking:e.cancelBooking,isCancelingBooking:e.isCancelingBooking})}))}),q=(n(119),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).initialState={bookings:[],isFetchingBookings:!1,isCancelingBooking:!1},n.fetchBookings=function(){n.setState(function(e){return{isFetchingBookings:!0}},Object(D.a)(T.a.mark(function e(){var t,a,r,i;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n      {\n        _id\n        createdAt\n        updatedAt\n        event {\n          _id\n          title\n          price\n          date\n        }\n        user {\n          _id\n        }\n      }\n      ",t={query:"\n        query {\n          bookings ".concat("\n      {\n        _id\n        createdAt\n        updatedAt\n        event {\n          _id\n          title\n          price\n          date\n        }\n        user {\n          _id\n        }\n      }\n      ","\n        }\n        ")},e.prev=2,a=n.props.appState.auth.token,e.next=6,F.fetchServer(t,a);case 6:if(!(r=e.sent).errors){e.next=10;break}return N.c.error("An error occured fetching bookings"),e.abrupt("return");case 10:if(i=r.data){e.next=13;break}throw new Error("An error occurred while fetching bookings");case 13:return e.abrupt("return",n.setState(function(e){return{isFetchingBookings:!1,bookings:i.bookings}}));case 16:return e.prev=16,e.t0=e.catch(2),N.c.error("Sorry, could not fetch bookings"),e.abrupt("return",n.setState(function(e){return{isFetchingBookings:!1}}));case 20:case"end":return e.stop()}},e,null,[[2,16]])})))},n.cancelBooking=function(e){n.setState(function(e){return{isCancelingBooking:!0}},Object(D.a)(T.a.mark(function t(){var a,r,i;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return"\n      {\n        _id\n      }\n      ",a={query:'\n        mutation {\n          cancelBooking(bookingId: "'.concat(e,'")\n          ').concat("\n      {\n        _id\n      }\n      ","\n        }\n        ")},t.prev=2,r=n.props.appState.auth.token,t.next=6,F.fetchServer(a,r);case 6:if(!(i=t.sent).errors){t.next=10;break}return N.c.error("An error occured cancelling booking"),t.abrupt("return");case 10:if(i.data){t.next=13;break}throw new Error("An error occurred while cancelling booking");case 13:return N.c.success("Booking cancelled!"),t.abrupt("return",n.setState(function(t){return{isCancelingBooking:!1,bookings:n.state.bookings.filter(function(t){return t._id!==e})}}));case 17:return t.prev=17,t.t0=t.catch(2),N.c.error("Sorry, could not cancel booking"),t.abrupt("return",n.setState(function(e){return{isCancelingBooking:!1}}));case 21:case"end":return t.stop()}},t,null,[[2,17]])})))},n.state=n.initialState,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){return this.props.updateNavigation({isAtBookings:!0,isAtEvents:!1,isAtLogin:!1,isAtRegister:!1,isAtUsers:!1}),this.fetchBookings()}},{key:"render",value:function(){return r.a.createElement("div",{id:"Bookings"},this.state.isFetchingBookings?r.a.createElement("div",{className:"bookings-spinner"},r.a.createElement(U,{variant:"indeterminate"})):r.a.createElement(z.a,{timeout:1e3,in:!this.state.isFetchingBookings},r.a.createElement("main",{className:"bookings-list"},this.state.bookings.length<=0?r.a.createElement(B.a,{variant:"overline",color:"textSecondary"},"You have no bookings"):r.a.createElement(W,{bookings:this.state.bookings,cancelBooking:this.cancelBooking,isCancelingBooking:this.state.isCancelingBooking}))))}}]),t}(r.a.Component)),P=n(65),V=n(184),J=n(176),$=n(177),G=n(178);function Y(e){var t=e.isOpenModal;return r.a.createElement("div",null,r.a.createElement(A,Object.assign({},e.openModalButton,{onClick:e.openModalButton.onClick,disabled:t}),e.openModalButton.title),r.a.createElement(V.a,{id:e.modalId,open:t,onClose:e.onCloseModal,"aria-labelledby":"form-dialog-title"},r.a.createElement(J.a,{id:"form-dialog-title"},r.a.createElement(B.a,{align:"left",variant:"inherit"},e.modalTitle)),r.a.createElement($.a,null,e.children),r.a.createElement(G.a,null,e.canCancel&&r.a.createElement(A,Object.assign({},e.cancelModalButton,{onClick:e.cancelModalButton&&e.cancelModalButton.onClick}),e.cancelModalButton&&e.cancelModalButton.title),e.canConfirm&&r.a.createElement(A,Object.assign({onClick:e.confirmModalButton&&e.confirmModalButton.onClick},e.confirmModalButton),e.confirmModalButton&&e.confirmModalButton.title))))}var K=n(180);function Q(e){return r.a.createElement(K.a,Object.assign({inputProps:{maxLength:e.maxLength}},e))}var X=n(87),Z=n(179),ee=n(90);function te(e){return r.a.createElement(X.b,{utils:ee.a},r.a.createElement(Z.a,e))}n(121);var ne=function(e){var t=e.event,n=t._id,a=t.price,i=t.title,o=t.date,c=t.creator,s=e.appState.auth.userId,u=e.eventBooking.selectedEventForBooking;return r.a.createElement("li",{className:"event-list-item"},r.a.createElement("div",{className:"event-slim-info"},r.a.createElement(B.a,{className:"event-title",variant:"h6",color:"textPrimary"},i),r.a.createElement("div",{className:"slim-wrapper"},r.a.createElement(B.a,{className:"event-price",variant:"subtitle2",color:"textSecondary"},"$",a),r.a.createElement(B.a,{className:"event-date",variant:"subtitle2",color:"textSecondary"},new Date(o).toDateString()))),r.a.createElement("div",{className:"event-details"},s!==c._id?r.a.createElement("div",{id:"EventBookingButton"},r.a.createElement(Y,{isOpenModal:e.eventBooking.isOpenEventBookingModal,onCloseModal:e.eventBooking.closeEventModal,modalId:"book-event-modal",modalTitle:"Event details",canCancel:!0,canConfirm:!0,openModalButton:{color:"primary",size:"small",variant:"outlined",type:"button",title:"Details",onClick:function(){if(n)return e.eventBooking.openBookEventModal(n)}},cancelModalButton:{color:"primary",size:"large",variant:"text",type:"button",title:"Cancel",onClick:e.eventBooking.closeEventModal},confirmModalButton:{color:"primary",size:"large",variant:"text",type:"button",title:"Book",disabled:e.eventBooking.isBookingEvent,onClick:e.eventBooking.handleEventBooking}},r.a.createElement("div",{className:"book-event-section"},r.a.createElement("div",null,r.a.createElement(B.a,{variant:"h6",color:"primary"},"Title:"),r.a.createElement(B.a,{variant:"subtitle2"},u.title)),r.a.createElement("div",null,r.a.createElement(B.a,{variant:"h6",color:"primary"},"Created at:"),r.a.createElement(B.a,{variant:"subtitle2"},new Date(u.createdAt).toDateString())),r.a.createElement("div",null,r.a.createElement(B.a,{variant:"h6",color:"primary"},"Description"),r.a.createElement(B.a,{variant:"subtitle2"},u.description)),r.a.createElement("div",null,r.a.createElement(B.a,{variant:"h6",color:"primary"},"Date:"),r.a.createElement(B.a,{variant:"subtitle2"},new Date(u.date).toDateString())),r.a.createElement("div",null,r.a.createElement(B.a,{variant:"h6",color:"primary"},"Price:"),r.a.createElement(B.a,{variant:"subtitle2"},"$",u.price))))):r.a.createElement(B.a,{variant:"overline"},"You're the owner")))},ae=(n(122),function(e){var t=e.events;return t&&r.a.createElement("ul",{className:"event-list"},t.map(function(t){return r.a.createElement(ne,{key:t._id,event:t,appState:e.appState,eventBooking:e.eventBookings})}))}),re=(n(123),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).initialState={events:[],createEventInput:{date:(new Date).toISOString(),description:"",price:0,title:""},selectedEventForBooking:{_id:"",createdAt:"",creator:{_id:"",createdAt:"",createdEvents:[],email:"",password:"",username:""},date:"",description:"",price:0,title:""},isOpenEventCreationModal:!1,isOpenEventBookingModal:!1,isCreatingEvent:!1,isBookingEvent:!1,isFetchingEvents:!1},n.initState=function(){n.setState(function(e){return n.initialState})},n.fetchEvents=function(){n.setState(function(e){return{isFetchingEvents:!0}},Object(D.a)(T.a.mark(function e(){var t,a,r,i;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n      {\n        _id\n        title\n        price\n        date\n        createdAt\n        description\n        creator {\n          _id\n        }\n      }\n      ",t={query:"\n        query {\n          events ".concat("\n      {\n        _id\n        title\n        price\n        date\n        createdAt\n        description\n        creator {\n          _id\n        }\n      }\n      ","\n        }\n        ")},e.prev=2,a=n.props.appState.auth.token,e.next=6,F.fetchServer(t,a);case 6:if(!(r=e.sent).errors){e.next=10;break}return N.c.error("An error occured fetching events"),e.abrupt("return");case 10:if(i=r.data){e.next=13;break}throw new Error("An error occurred while fetching events");case 13:return e.abrupt("return",n.setState(function(e){return{isFetchingEvents:!1,events:i.events}}));case 16:return e.prev=16,e.t0=e.catch(2),N.c.error("Sorry, could not fetch events"),e.abrupt("return",n.setState(function(e){return{isFetchingEvents:!1}}));case 20:case"end":return e.stop()}},e,null,[[2,16]])})))},n.onTitleInputChange=function(e){e.persist();var t=e.target;n.setState(function(e){return{createEventInput:Object(c.a)({},e.createEventInput,{title:t.value})}})},n.onPriceInputChange=function(e){e.persist();var t=e.target;n.setState(function(e){return{createEventInput:Object(c.a)({},e.createEventInput,{price:t.value})}})},n.onDescriptionInputChange=function(e){e.persist();var t=e.target;n.setState(function(e){return{createEventInput:Object(c.a)({},e.createEventInput,{description:t.value})}})},n.onDateInputChange=function(e){n.setState(function(t){return{createEventInput:Object(c.a)({},t.createEventInput,{date:new Date(e).toISOString()})}})},n.createEvent=function(){var e=Object(D.a)(T.a.mark(function e(t){var a,r,i,o;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n    {\n      _id\n      title\n      price\n      date\n      createdAt\n      description\n      creator {\n        _id\n      }\n    }\n    ",a={query:'\n      mutation {\n        createEvent(eventInput: {title: "'.concat(t.title,'", price: ').concat(t.price,', description: "').concat(t.description,'", date: "').concat(t.date,'"})\n        ').concat("\n    {\n      _id\n      title\n      price\n      date\n      createdAt\n      description\n      creator {\n        _id\n      }\n    }\n    ","\n      }\n      ")},e.prev=2,r=n.props.appState.auth.token,e.next=6,F.fetchServer(a,r);case 6:if(!(i=e.sent).errors){e.next=10;break}return N.c.error("An error occured"),e.abrupt("return",n.setState(function(e){return{isCreatingEvent:!1}}));case 10:if(o=i.data){e.next=13;break}throw new Error("An error occurred while creating event");case 13:return N.c.success("Event created!"),e.abrupt("return",n.setState(function(e){var t=Object(P.a)(e.events);return t.push(o.createEvent),{events:t,isCreatingEvent:!1,isOpenEventCreationModal:!1,createEventInput:{date:(new Date).toISOString(),description:"",price:0,title:""}}}));case 17:throw e.prev=17,e.t0=e.catch(2),N.c.error("Sorry, could not create event"),e.t0;case 21:case"end":return e.stop()}},e,null,[[2,17]])}));return function(t){return e.apply(this,arguments)}}(),n.handleEventCreation=Object(D.a)(T.a.mark(function e(){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.setState(function(e){return{isCreatingEvent:!0}},Object(D.a)(T.a.mark(function e(){var t;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={date:n.state.createEventInput.date.trim(),description:n.state.createEventInput.description.trim(),price:n.state.createEventInput.price,title:n.state.createEventInput.title.trim()},e.prev=1,n.isValidEventInput(t)){e.next=5;break}throw new Error("invalid event input");case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),N.c.error("Invalid data"),e.abrupt("return",n.setState(function(e){return{isCreatingEvent:!1}}));case 11:return e.prev=11,e.next=14,n.createEvent(t);case 14:return e.abrupt("return");case 17:return e.prev=17,e.t1=e.catch(11),e.abrupt("return",n.setState(function(e){return{isCreatingEvent:!1}}));case 20:case"end":return e.stop()}},e,null,[[1,7],[11,17]])})));case 1:case"end":return e.stop()}},e)})),n.openCreateEventModal=function(){return n.setState(function(e){return{isOpenEventCreationModal:!0}})},n.closeEventModal=function(){return n.setState(function(e){return{isCreatingEvent:!1,isBookingEvent:!1,isOpenEventCreationModal:!1,isOpenEventBookingModal:!1,createEventInput:{date:(new Date).toISOString(),description:"",price:0,title:""}}})},n.openBookEventModal=function(e){var t=n.state.events.find(function(t){return t._id===e});return t?n.setState(function(e){return{isOpenEventBookingModal:!0,selectedEventForBooking:t}}):void N.c.error("Sorry, an error occurred fetching event details")},n.handleEventBooking=function(){n.setState(function(e){return{isBookingEvent:!0}},Object(D.a)(T.a.mark(function e(){var t,a,r;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        {\n          _id\n        }\n        ",t={query:'\n          mutation {\n            bookEvent(eventId: "'.concat(n.state.selectedEventForBooking._id,'")\n            ').concat("\n        {\n          _id\n        }\n        ","\n          }\n          ")},e.prev=2,a=n.props.appState.auth.token,e.next=6,F.fetchServer(t,a);case 6:if(!(r=e.sent).errors){e.next=10;break}return N.c.error("An error occured"),e.abrupt("return",n.setState(function(e){return{isBookingEvent:!1}}));case 10:if(r.data){e.next=13;break}throw new Error("An error occurred while booking event");case 13:return N.c.success("Event booking done!"),e.abrupt("return",n.setState(function(e){return{isOpenEventBookingModal:!1,isBookingEvent:!1}}));case 17:e.prev=17,e.t0=e.catch(2),N.c.error("Sorry, could not book event"),n.setState(function(e){return{isBookingEvent:!1}});case 21:case"end":return e.stop()}},e,null,[[2,17]])})))},n.state=n.initialState,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){return this.props.updateNavigation({isAtBookings:!1,isAtEvents:!0,isAtLogin:!1,isAtRegister:!1,isAtUsers:!1}),this.fetchEvents()}},{key:"isValidEventInput",value:function(e){var t=e.date,n=e.description,a=e.price,r=e.title;return!(t.length<1||n.length<1||a<=0||r.length<1)}},{key:"render",value:function(){return r.a.createElement("div",{id:"Events"},r.a.createElement("div",{id:"EventCreationButton"},r.a.createElement(Y,{isOpenModal:this.state.isOpenEventCreationModal,onCloseModal:this.closeEventModal,modalId:"create-event-modal",modalTitle:"Event creation",canCancel:!0,canConfirm:!0,openModalButton:{color:"primary",size:"large",variant:"contained",type:"button",title:"Create event",onClick:this.openCreateEventModal},cancelModalButton:{color:"primary",size:"large",variant:"text",type:"button",title:"Cancel",onClick:this.closeEventModal},confirmModalButton:{color:"primary",size:"large",variant:"text",type:"button",title:"Create",disabled:this.state.isCreatingEvent,onClick:this.handleEventCreation}},r.a.createElement("div",{className:"create-event-form"},r.a.createElement("div",{className:"form-control"},r.a.createElement(Q,{maxLength:40,autoComplete:"off",onChange:this.onTitleInputChange,label:"Name",type:"text",name:"name",id:"event-name",margin:"normal",variant:"outlined"})),r.a.createElement("div",{className:"form-control"},r.a.createElement(Q,{autoComplete:"off",onChange:this.onPriceInputChange,label:"Price",type:"number",name:"price",id:"event-price",margin:"normal",variant:"outlined"})),r.a.createElement("div",{className:"form-control"},r.a.createElement(te,{value:this.state.createEventInput.date,margin:"normal",label:"Date",inputVariant:"outlined",onChange:this.onDateInputChange})),r.a.createElement("div",{className:"form-control"},r.a.createElement(Q,{maxLength:140,autoComplete:"off",onChange:this.onDescriptionInputChange,label:"Description",type:"text",name:"description",id:"event-description",margin:"normal",variant:"outlined",multiline:!0,rows:1}))))),this.state.isFetchingEvents?r.a.createElement("div",{className:"events-spinner"},r.a.createElement(U,{variant:"indeterminate"})):r.a.createElement(z.a,{timeout:1e3,in:!this.state.isFetchingEvents},r.a.createElement("main",{className:"events-list"},this.state.events.length<=0?r.a.createElement(B.a,{variant:"overline",color:"textSecondary"},"There are no events"):r.a.createElement(ae,{events:this.state.events,appState:this.props.appState,eventBookings:{closeEventModal:this.closeEventModal,handleEventBooking:this.handleEventBooking,isBookingEvent:this.state.isBookingEvent,isOpenEventBookingModal:this.state.isOpenEventBookingModal,openBookEventModal:this.openBookEventModal,selectedEventForBooking:this.state.selectedEventForBooking}}))))}}]),t}(r.a.Component)),ie=(n(124),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).initialState={email:"",password:"",token:"",tokenExpiration:"",userId:"",isHandlingAuth:!1,isLoggingWithToken:!1},n.getTokenFromLocalStorage=function(){return window.localStorage.getItem("token")},n.initState=function(){n.setState(function(e){return n.initialState})},n.onEmailInputChange=function(e){e.persist();var t=e.target;n.setState(function(e){return{email:t.value}})},n.onPasswordInputChange=function(e){e.persist();var t=e.target;n.setState(function(e){return{password:t.value}})},n.register=function(){var e=Object(D.a)(T.a.mark(function e(t){var a,r,i;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        {\n          _id\n          email\n          username\n          createdAt\n          password\n        }\n        ",a={query:'\n          mutation {\n            registerUser(userInput: {email: "'.concat(t.email,'", password: "').concat(t.password,'"}) ').concat("\n        {\n          _id\n          email\n          username\n          createdAt\n          password\n        }\n        ","\n          }\n          ")},e.prev=2,e.next=5,F.fetchServer(a);case 5:if(!(r=e.sent).errors){e.next=9;break}return N.c.error("That email is already registered!"),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!1}}));case 9:if(i=r.data){e.next=12;break}throw new Error("An error occurred while signing up");case 12:return e.abrupt("return",n.setState(function(e){return{userId:i.registerUser._id,email:i.registerUser.email,password:""}},Object(D.a)(T.a.mark(function e(){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.login(t);case 3:return e.abrupt("return");case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return");case 9:case"end":return e.stop()}},e,null,[[0,6]])}))));case 15:throw e.prev=15,e.t0=e.catch(2),N.c.error("Sorry, could not register"),e.t0;case 19:case"end":return e.stop()}},e,null,[[2,15]])}));return function(t){return e.apply(this,arguments)}}(),n.login=function(){var e=Object(D.a)(T.a.mark(function e(t){var a,r,i;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n        {\n          userId\n          token\n          tokenExpiration\n        }\n        ",a={query:'\n          query {\n            login(authInput: {email: "'.concat(t.email,'", password: "').concat(t.password,'"})\n            ').concat("\n        {\n          userId\n          token\n          tokenExpiration\n        }\n        ","\n          }\n          ")},e.prev=2,e.next=5,F.fetchServer(a);case 5:if(!(r=e.sent).errors){e.next=9;break}return N.c.error("Invalid credentials"),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!1}}));case 9:if(i=r.data){e.next=12;break}throw new Error("An error occurred while signing in");case 12:return N.c.success("Welcome to gEvent!"),e.abrupt("return",n.setState(function(e){return{userId:i.login.userId,email:t.email,password:"",token:i.login.token,tokenExpiration:i.login.tokenExpiration,isHandlingAuth:!1}},function(){n.saveAuthTokenInLocalStorage(n.state.token),n.props.authUser(n.state)}));case 16:throw e.prev=16,e.t0=e.catch(2),N.c.error("Sorry, could not login"),e.t0;case 20:case"end":return e.stop()}},e,null,[[2,16]])}));return function(t){return e.apply(this,arguments)}}(),n.loginWithToken=function(){var e=Object(D.a)(T.a.mark(function e(t){var a,r,i;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return"\n    {\n      userId\n      email\n      tokenExpiration\n    }\n    ",a={query:'\n      query {\n        loginWithToken(tokenInput: {token: "'.concat(t,'"})\n        ').concat("\n    {\n      userId\n      email\n      tokenExpiration\n    }\n    ","\n      }\n      ")},e.prev=2,e.next=5,F.fetchServer(a);case 5:if(!(r=e.sent).errors){e.next=9;break}return N.c.error("Invalid credentials"),e.abrupt("return",n.setState(function(e){return{isLoggingWithToken:!1,isHandlingAuth:!1}}));case 9:if(i=r.data){e.next=12;break}throw new Error("An error occurred while signing in");case 12:return N.c.success("Welcome to gEvent!"),e.abrupt("return",n.setState(function(e){return{userId:i.loginWithToken.userId,email:i.loginWithToken.email,password:"",token:t,tokenExpiration:i.loginWithToken.tokenExpiration,isHandlingAuth:!1,isLoggingWithToken:!1}},function(){n.props.authUser(n.state)}));case 16:throw e.prev=16,e.t0=e.catch(2),N.c.error("Sorry, could not login"),e.t0;case 20:case"end":return e.stop()}},e,null,[[2,16]])}));return function(t){return e.apply(this,arguments)}}(),n.saveAuthTokenInLocalStorage=function(e){window.localStorage.setItem("token",e)},n.handleAuthUser=function(){var e=Object(D.a)(T.a.mark(function e(t){return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!0}},Object(D.a)(T.a.mark(function e(){var t,a;return T.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t={email:n.state.email.trim(),password:n.state.password.trim()},e.prev=1,n.isValidUserInput(t)){e.next=5;break}throw new Error("invalid user input");case 5:e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(1),N.c.error("Invalid credentials"),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!1}}));case 11:if(!(a=n.props.appState.navigation).isAtRegister&&!a.isAtLogin){e.next=30;break}if(e.prev=13,!a.isAtRegister){e.next=20;break}return e.next=17,n.register(t);case 17:return e.abrupt("return");case 20:return e.next=22,n.login(t);case 22:return e.abrupt("return");case 23:e.next=28;break;case 25:return e.prev=25,e.t1=e.catch(13),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!1}}));case 28:e.next=32;break;case 30:return N.c.error("An error occurred"),e.abrupt("return",n.setState(function(e){return{isHandlingAuth:!1}}));case 32:case"end":return e.stop()}},e,null,[[1,7],[13,25]])}))));case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.state=n.initialState,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"componentDidMount",value:function(){var e=this;return this.setState(function(e){return{isLoggingWithToken:!0,isHandlingAuth:!0}},Object(D.a)(T.a.mark(function t(){var n;return T.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.getTokenFromLocalStorage())){t.next=11;break}return t.prev=2,t.next=5,e.loginWithToken(n);case 5:return t.abrupt("return");case 8:return t.prev=8,t.t0=t.catch(2),t.abrupt("return",e.setState(function(e){return{isLoggingWithToken:!1,isHandlingAuth:!1}}));case 11:return t.abrupt("return",e.setState(function(e){return{isLoggingWithToken:!1,isHandlingAuth:!1}}));case 12:case"end":return t.stop()}},t,null,[[2,8]])})))}},{key:"isValidUserInput",value:function(e){var t=e.email,n=e.password;return!(t.length<1||n.length<1)}},{key:"render",value:function(){var e=this.props.appState;return this.state.isLoggingWithToken?r.a.createElement(U,{thickness:1,size:100,variant:"indeterminate"}):r.a.createElement("form",{id:"Auth",onSubmit:this.handleAuthUser},r.a.createElement("div",{className:"form-control"},r.a.createElement(Q,{autoComplete:"on",onChange:this.onEmailInputChange,label:"Email",type:"email",name:"email",id:"email",margin:"dense"})),r.a.createElement("div",{className:"form-control"},r.a.createElement(Q,{autoComplete:"on",onChange:this.onPasswordInputChange,label:"Password",type:"password",name:"password",id:"password",margin:"dense"})),r.a.createElement("div",{className:"form-actions"},r.a.createElement(A,{disabled:this.state.isHandlingAuth,size:"medium",type:"submit",variant:"contained",color:"primary"},e.navigation.isAtLogin&&"Login",e.navigation.isAtRegister&&"Register")))}}]),t}(r.a.Component)),oe=function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).initialState={},n.state=n.initialState,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this,t=this.props.appState.auth.token.length>0;return r.a.createElement("main",{id:"MainApp"},r.a.createElement(L,null),r.a.createElement(M.d,null,t&&r.a.createElement(M.a,{from:"/",to:"/events",exact:!0}),t&&r.a.createElement(M.a,{from:"/auth",to:"/events",exact:!0}),!t&&r.a.createElement(M.b,{path:"/auth",render:function(t){return r.a.createElement(ie,Object.assign({},t,{appState:e.props.appState,authUser:e.props.authUser}))}}),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(M.b,{path:"/events",render:function(t){return r.a.createElement(re,Object.assign({},t,{appState:e.props.appState,updateNavigation:e.props.updateNavigation}))}}),r.a.createElement(M.b,{path:"/bookings",render:function(t){return r.a.createElement(q,Object.assign({},t,{appState:e.props.appState,updateNavigation:e.props.updateNavigation}))}})),t&&r.a.createElement(M.a,{to:"/events"}),!t&&r.a.createElement(M.a,{to:"/auth"})))}}]),t}(r.a.Component),ce=(n(125),function(e){function t(e){var n;return Object(s.a)(this,t),(n=Object(l.a)(this,Object(p.a)(t).call(this,e))).initialState={navigation:{isAtLogin:!0,isAtRegister:!1,isAtBookings:!1,isAtEvents:!1,isAtUsers:!1},auth:{email:"",password:"",userId:"",token:"",tokenExpiration:"",isHandlingAuth:!1,isLoggingWithToken:!1}},n.initState=function(){n.setState(function(e){return n.initialState})},n.switchAuthModeChange=function(){n.setState(function(e){return{navigation:Object(c.a)({},e.navigation,{isAtLogin:!e.navigation.isAtLogin,isAtRegister:!e.navigation.isAtRegister})}})},n.authUser=function(e){n.setState(function(t){return{navigation:Object(c.a)({},t.navigation,{isAtLogin:!1,isAtRegister:!1}),auth:e}})},n.removeAuthTokenInLocalStorage=function(){window.localStorage.removeItem("token")},n.logoutUser=function(){n.removeAuthTokenInLocalStorage(),n.initState()},n.updateNavigation=function(e){n.setState(function(t){return{navigation:e}})},n.state=n.initialState,n}return Object(d.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{id:"App"},r.a.createElement(h.a,null,r.a.createElement(j,{appState:this.state,switchRegisterLogin:this.switchAuthModeChange,logout:this.logoutUser}),r.a.createElement(oe,{appState:this.state,authUser:this.authUser,updateNavigation:this.updateNavigation})))}}]),t}(r.a.Component));n(126),n(127);o.a.render(r.a.createElement(ce,null),document.getElementById("root"))}},[[100,1,2]]]);
//# sourceMappingURL=main.622852ac.chunk.js.map